```
IIP: 42
Title: Reduce Block Interval to 3 Seconds
Author: Chen Chen ((chenchen@iotex.me))
Status: Draft
Type: Standards Track
Category: Core
Created: 2025-03-20
```

## Abstract

This proposal advocates reducing the block interval of blockchain from 5 seconds to 3 seconds through consensus parameter optimization and network-layer enhancements. By shortening the block interval, the network aims to achieve higher transaction throughput, lower latency for transaction finality, and improved user experience, particularly for latency-sensitive applications.

## Motivation

Addressing User and Developer Demands
- High Latency Concerns: The current 5-second block interval is suboptimal for applications requiring near-instant finality, such as gaming, DeFi arbitrage, and IoT microtransactions.
- Competitive Benchmarking: Leading Layer-1 blockchains (e.g., Solana, Avalanche, BSC) and Layer-2 solutions (e.g., Polygon PoS) have adopted sub-3-second intervals and even shorter, setting user expectations for faster confirmations. Retaining a 5-second interval risks ecosystem migration to faster chains.

## Specification

### Consensus Params

**Block Interval**

The consensus process in each round is divided into four stages: Propose, Endorsement, Lock, and Commit. Currently, each block interval is 5 seconds. We propose to reduce the time of the Propose and Lock stages in order to lower the overall block interval to 3 seconds.

| Stage    | Propose    | Endorsement    | Lock    | Commit    |
|---|---|---|---|---|
| Functions   | Mint proposal and broadcast | Validate proposal and vote | Vote    | Commit to storage |
| TTL (5s)    | 2s    | 1s    | 1s    | 1s    |
| TTL (3s)    | 1s    | 1s    | 0.5s    | 0.5s    |

**Epoch**

The number of delegates (num_delegates) is 24, and the number of sub-epochs (num_sub_epochs) is changed from 30 to 50, so that each epoch will include 1,200 blocks (originally 720 blocks), still lasting for 1 hour.

**Block Gas Limit**

The block gas limit is reduced from 50 million to 30 million.

### Optimistic Mint

- Optimistic Mint: when a delegate receives a proposal (P1), if it's the proposer of the next round, it can prepare the next proposal (P2) in advance without waiting for P1 to be confirmed.

![optimistic-mint](./assets/iip-42-optimistic-mint.png)

- Fallback: If consensus is not reached in a certain round, then fallback to mint proposal at next round start

![fallback-mint](./assets/iip-42-mint-fallback.png)

- Max-Mint-Time: The time limit for preparing the next proposal should not exceed 1 second, in order to avoid that proposal being too large and unable to complete the subsequent consensus stages in a timely manner.

### System Staking Changes
#### V1 Staking Contract - Add bucket types
Add three bucket types:
- 10,000 IOTX , 2,620,800 blocks (91 days)
- 100,000 IOTX, 2,620,800 blocks
- 1,000,000 IOTX, 2,620,800 blocks

#### V2 Staking Contract - Not recommend any more
- New Stakes are not allowed after hardfork
- Existed buckets are only allowed to withdraw or migrate to v3 contract

#### Introduce V3 Staking Contract
To fundamentally address the issue of changes in the block interval causing the duration of old contracts to also change, we are introducing a v3 staking contract.

**Timestamp Based Duration**

The main change in v3 is that the staking duration is calculated using natural timestamps instead of block numbers.

**Legacy Migration**

Another feature is the support for migrating v2 buckets to v3, allowing for a one-to-one exchange.
- Only the bucket owner, and only when it is in a locked state, can perform the migration.
- The original bucket's owner is changed to the v3 contract address, while the voting rights are directed to a null address.
- A v3 bucket will be generated owned by the staker, with the amount and delegate of the new bucket being the same as the original bucket, and the duration calculated based on the original bucket's duration multiplied by 5 seconds.

#### Native Migration
After the hard fork, the buckets generated by the native migration action will also be changed to the v3 contract.

### Rationale

#### Will shortening the block interval lead to the inability to reach consensus?

Shortening the block interval intuitively seems to reduce the robustness of the network in reaching consensus under high-load conditions to some extent. However, in practice, there are currently idle resources. The actual network performance is as follows:

| Percentile | TPS | Block Gas | Statistic Metrics |
|---|---|---|---|
|    |    |    | Mint    | P2P Latency | Validate | Commit (Stage) | Propose Stage (mint + broadcast) |
| P50    | 25    | 1m    | 80ms    | 50ms    | 80ms    | 200ms    | 130ms    |
| P95    | 80    | 8m    | 500ms    | 120ms    | 340ms    | 500ms    | 620ms    |


- Under normal circumstances, consensus can still be reached in a timely manner after lowering the block interval
- If the block gas limit needs to be fully utilized, it can be achieved by upgrading the delegate hardware resource

Additionally, the introduction of the optimistic mint mechanism provides delegates with ample time to complete mint and broadcast. In most cases, this enhances the robustness of the network compared to the previous 2-second time frame.

#### Impacts on Legacy System Staking Contracts

In the Quebec upgrade, we introduced the Staking Contract (v1: 0x68db92a6a78a39dcaff1745da9e89e230ef49d3d) to unlock liquidity staking. In the Upernavik upgrade, we introduced the Native Staking Migration feature. Due to the limitations on staking types in the v1 contract, we also introduced the v2 contract (0x8ee521d2179576bcc4bd33a00904e96a11678052) to facilitate a smooth migration experience. 

Currently, both versions are in use. The v1 version has been integrated into dapps such as uniIOTX, while the v2 version is only used by retail users.

Block interval reduction impacts these two staking contracts,  since the contract staking duration is determined based on the block number, and given that the block interval has been reduced to three seconds. The impacts are as follows:

- Early Withdrawal: for existing buckets, allowing unstaking to occur 40% earlier by natural time. 
- Voting Weight Reduction: the staking votes for the buckets are correspondingly reduced.
- Maximum Staking Duration Reduction:
  - For v2, the maximum staking duration has been reduced from 36 months to around 21.6 months. 
  - For v1, it has been reduced from 91 days to 54 days

### Backward Compatibility
What should legacy contract stakers do?

For v1 stakers:
  - If you are not concerned about the reduction in duration, there is nothing you need to do; it will continue to work normally.
  - If you want to restore the original duration, simply modify the bucket type to the newly added staking type with a duration of 91 days.

For v2 stakers:
  - It is strongly recommended for stakers to migrate to  v3, so that the staking duration will remain consistent with the past.
  - v2 is still working for existing buckets, but only allowed withdrawal. There are some drawbacks:
    - v2 only supports a maximum duration of 21.6 months.
    - It will be affected again when the block interval is adjusted in the future.

### Security Considerations

## Copyright

Copyright and related rights waived via [CC0](https://creativecommons.org/publicdomain/zero/1.0/).
